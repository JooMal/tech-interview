# 데드락
첫 번째 스레드는 두 번째 스레드가 들고 있는 객체의 락이 풀리기를 기다리고 있고, 두 번째 스레드 역시 첫 번째 스레드가 들고있는 객체의 락이 풀리기를 기다리는 상황이다.
즉 모든 스레드가 락이 풀리기를 기다리고 있기 때문에, 무한 대기 상태에 빠지게 된다. 이런 스레드를 교착상태에 빠졌다고 한다.

### 교착 상태의 조건
1. 상호 배제(Mutual Exclusion) : 공유 자원에 대한 접근 권한이 제한되어, 한 번에 한 프로세스만 공유 자원을 사용할 수 있다.
2. 점유대기(hold and wait) : 공유 자원에 대한 접근 권한을 갖고 있는 프로세스가 다른 자원도 요청하며 대기하고 있는 상황
3. 비선점(non-preempltion) : 다른 프로세스의 접근 권한을 강제로 취소할 수 없다.
4. 순환대기(circular wait) : 두 개 이상의 프로세스가 자원 접근을 기다리는데, 대기 상태의 사이클이 발생한다.

### 교착 상태 방지
1. 예방
	- 4가지 조건들 중 하나를 제거하면 된다. 공유 자원의 대부분이 한 번에 한 프로세스만 사용할 수 있으므로, 1번 조건은 제거하기 어렵다. 이에 따라 대부분의 교착상태 방지 알고리즘은 4번 조건(순환 대기)를 방지하는 데에 초점이 맞추어져 있다.
2. 회피
	- 교착상태의 발생조건을 없애기보단, 발생하지 않도록 알고리즘을 적용한다. -> 자원할당 그래프 알고리즘, 은행원 알고리즘	
3. 회복
	- 만약 교착상태가 발생하면 발생 이후에 문제를 해결
4. 무시
	- 교착상태 해결할 때에 Context Switching에 따르는 오버헤드로 인한 성능 저하가 있으므로, 데드락에 의한 성능저하보다 해결할 떄의 성능 저하가 큰 경우에는 무시한다.
	- UNIX를 포함한 대부분의 운영체제에서는 교착 상태 문제를 무시한 상태로 동작한다. 데드락은 일 년에 한 번 정도 발생하므로, 성능이 저하되면 시스템을 중단하고 인위적인 재시작을 통해 해결한다. 무시하는 것이 결국 비용이 적게 드는 까닭이다.

### 자원할당그래프
- 교착상태 탐지를 하기 위한 그래프
교착 상태를 관리하기 위한 유향 그래프이다. 요청이 있을 시엔 요청 에지를 생성하고, 사용이 되면 요청 에지를 할당 에지로 변환하고, 해제된다면 할당 에지를 삭제한다.
자원 할당 그래프가 사이클을 갖고 있다면, 교착 상태일 가능성이 있다. 사이클이 존재한다고 반드시 교착상태인 것은 아니다.

### Ref
데드락에 대해 굉장히 상세하게 다루는 [블로그 게시글](https://m.blog.naver.com/PostView.nhn?blogId=three_letter&logNo=220380867227&proxyReferer=https%3A%2F%2Fwww.google.com%2F)

